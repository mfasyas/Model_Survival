setwd("F:\\Coding\\R\\Model_Survival")
setwd("F:\\Coding\\R\\Model_Survival")
# Ganti dengan directory anda
getwd()
library(survival)
library(survminer)
library(dplyr)
library(Rcpp)
data <- read.csv("Data_Project_Modusr2_Cleaned_alt.csv")
head(data)
df <- data[, setdiff(names(data), c("Churn", "SeniorCitizen"))]
head(df)
View(df)
# Diambil kolom tenure, Churn, Contract, InternetService, SeniorCitizen, dan PaymentMethod
# Ini berdasarkan informasi dari instruksi Project 2
# Berdasarkan data dan deskripsi yang diobservasi di sini adalah status churn (1 ketika tidak aktif, 0 ketika aktif/censored)
#===========================================================================
# Nomor 1
#===========================================================================
# Apakah ada perbedaan waktu survival antar jenis kontrak (Month-to-month, One year, Two year)
names(df)[names(df) == "ChurnEncode"] <- "Churn"
names(df)[names(df) == "SeniorCitizenEncode"] <- "SeniorCitizen"
df$Churn <- ifelse(df$Churn == "Yes", 1, 0)
dfcurve0 <- survfit(Surv(tenure, Churn)~Contract, data = df)
print(dfcurve0)
summary(dfcurve0)
# Plot Kaplan-Meier terhadap grup "Month", "One Year", dan "Two Year"
plot0 <- ggsurvplot(
dfcurve0,
size = 1,
palette = c("#E7B800", "#2E9FDF","#2b1101"),
conf.int = TRUE,
pval = TRUE,
legend.labs = c("Month", "One Year", "Two Year"),
ggtheme = theme_classic(),
risk.table = FALSE,
censor = FALSE
)
print(plot0)
pair_wise0 <- pairwise_survdiff(Surv(tenure, Churn)~Contract, data = df)
pair_wise0
surv_diff0 <- survdiff(Surv(tenure, Churn)~Contract, data = df)
surv_diff0
#===========================================================================
# Nomor 2
#===========================================================================
# Apakah ada tren peningkatan/penurunan survival seiring bertambahnya tagihan biaya
# per bulan (MonthlyCharges)
range(df$MonthlyCharges)
# Nilai berada di antara 18.40 dan 118.65
df$ChargesGroup <- ifelse(
df$MonthlyCharges < 40, 1,
ifelse(
df$MonthlyCharges <80, 2, 3
)
)
dfcurve1 <- survfit(Surv(tenure, Churn)~ChargesGroup, data = df)
print(dfcurve1)
summary(dfcurve1)
# Plot Kaplan-Meier terhadap grup "Month", "One Year", dan "Two Year"
plot1 <- ggsurvplot(
dfcurve1,
size = 1,
palette = c("#E7B800", "#2E9FDF","#2b1101"),
conf.int = TRUE,
pval = TRUE,
legend.labs = c("Charges < 40", "Charges between 40 to 80", "Charges > 80"),
ggtheme = theme_classic(),
risk.table = FALSE,
censor = FALSE
)
print(plot1)
# Uji trend menggunakan coxph()
trend_test <- coxph(Surv(tenure, Churn)~factor(ChargesGroup), data = df)
summary(trend_test)
#===========================================================================
# Nomor 3
#===========================================================================
# Apakah ada perbedaan survival antara jenis kontrak setelah dikontrol oleh
# status usia lanjut?
dfcurve2 <- survfit(Surv(tenure, Churn)~Contract + strata(SeniorCitizen), data = df)
print(dfcurve2)
summary(dfcurve2)
plot2 <- ggsurvplot(
dfcurve2,
size = 1,
palette = c("#E7B800", "#2E9FDF","#2b1101", "#2b2823", "#cfe079", "#4d5430"),
conf.int = FALSE,
pval = TRUE,
legend.labs = c("Month-No", "Month-Yes", "One Year-No", "One Year-Yes", "Two Year-No", "Two Year-Yes"),
ggtheme = theme_classic(),
risk.table = FALSE,
censor = FALSE
)
print(plot2)
# stratifikasi
cox_model <- coxph(Surv(tenure, Churn)~Contract + strata(SeniorCitizen), data = df)
summary(cox_model)
ggforest(cox_model, data = df)
dfcurve3 <- survfit(Surv(tenure, Churn)~SeniorCitizen, data = df)
print(dfcurve3)
summary(dfcurve3)
plot3 <- ggsurvplot(
dfcurve3,
size = 1,
palette = c("#E7B800", "#2E9FDF"),
conf.int = FALSE,
pval = TRUE,
legend.labs = c("NonSenior", "Senior"),
ggtheme = theme_classic(),
risk.table = FALSE,
censor = FALSE
)
print(plot3)
plot2 <- ggsurvplot(
dfcurve2,
size = 1,
palette = c("#E7B800", "#2E9FDF","#2b1101", "#2b2823", "#cfe079", "#4d5430"),
conf.int = FALSE,
pval = FALSE,
legend.labs = c("Month-No", "Month-Yes", "One Year-No", "One Year-Yes", "Two Year-No", "Two Year-Yes"),
ggtheme = theme_classic(),
risk.table = FALSE,
censor = FALSE
)
print(plot2)
